<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Justin Andrew Johnson - Research</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Justin Andrew Johnson</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../publications/index.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-teaching" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Teaching</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-teaching">    
        <li>
    <a class="dropdown-item" href="../teaching/index.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../teaching/applied_earth_economy_modeling.html">
 <span class="dropdown-text">Applied Earth-Economy Modeling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../teaching/natural_resource_economics.html">
 <span class="dropdown-text">Natural Resource Economics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../teaching/principles_of_microeconomics.html">
 <span class="dropdown-text">Principles of Microeconomics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../teaching/big_data_ml_and_ai_for_economists.html">
 <span class="dropdown-text">Big Data, Machine Learning and AI for Economists</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../teaching/environmental_economics.html">
 <span class="dropdown-text">Undergraduate Environmental Economics</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link active" href="../research/index.html" aria-current="page"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../books/index.html"> 
<span class="menu-text">Books</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-gtap-invest" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">GTAP-InVEST</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-gtap-invest">    
        <li>
    <a class="dropdown-item" href="../gtap_invest/index.html">
 <span class="dropdown-text">GTAP-InVEST Home</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../gtap_invest/user_guide/index.html">
 <span class="dropdown-text">User Guide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../gtap_invest/results/index.html">
 <span class="dropdown-text">Results</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-software" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Software</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-software">    
        <li>
    <a class="dropdown-item" href="../earth_economy_devstack/index.html">
 <span class="dropdown-text">Earth-Economy Devstack</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mesh/index.html">
 <span class="dropdown-text">MESH</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../earth_economy_devstack/seals_overview.html">
 <span class="dropdown-text">SEALS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../data/index.html"> 
<span class="menu-text">Data</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/jandrewjohnson"> 
<span class="menu-text">GitHub</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="incremental">
  <li><a href="#research-overview" id="toc-research-overview" class="nav-link active" data-scroll-target="#research-overview">Research Overview</a>
  <ul class="incremental collapse">
  <li><a href="#connecting-ecosystem-services-and-natural-capital-to-computable-general-equilibrium" id="toc-connecting-ecosystem-services-and-natural-capital-to-computable-general-equilibrium" class="nav-link" data-scroll-target="#connecting-ecosystem-services-and-natural-capital-to-computable-general-equilibrium">1. Connecting ecosystem services and natural capital to computable general equilibrium</a></li>
  <li><a href="#predicting-land-use-change-and-environmental-impacts" id="toc-predicting-land-use-change-and-environmental-impacts" class="nav-link" data-scroll-target="#predicting-land-use-change-and-environmental-impacts">2. Predicting land-use change and environmental impacts</a></li>
  <li><a href="#advancing-ecosystem-service-methodology" id="toc-advancing-ecosystem-service-methodology" class="nav-link" data-scroll-target="#advancing-ecosystem-service-methodology">3. Advancing ecosystem service methodology</a></li>
  <li><a href="#using-machine-learning-and-ai-to-accelerate-economic-sustainability-research" id="toc-using-machine-learning-and-ai-to-accelerate-economic-sustainability-research" class="nav-link" data-scroll-target="#using-machine-learning-and-ai-to-accelerate-economic-sustainability-research">4. Using machine learning and AI to accelerate economic sustainability research</a></li>
  </ul></li>
  <li><a href="#future-research-directions" id="toc-future-research-directions" class="nav-link" data-scroll-target="#future-research-directions">Future research directions</a>
  <ul class="incremental collapse">
  <li><a href="#new-methods-in-linking-general-equilibrium-to-earth-systems-models" id="toc-new-methods-in-linking-general-equilibrium-to-earth-systems-models" class="nav-link" data-scroll-target="#new-methods-in-linking-general-equilibrium-to-earth-systems-models">1.&nbsp;New methods in linking general equilibrium to earth systems models</a></li>
  <li><a href="#what-is-possible-versus-how-to-get-there" id="toc-what-is-possible-versus-how-to-get-there" class="nav-link" data-scroll-target="#what-is-possible-versus-how-to-get-there">2.&nbsp;What is possible versus how to get there?</a></li>
  <li><a href="#natural-capital-accounting-and-private-sector-investing" id="toc-natural-capital-accounting-and-private-sector-investing" class="nav-link" data-scroll-target="#natural-capital-accounting-and-private-sector-investing">3.&nbsp;Natural capital accounting and private sector investing</a></li>
  <li><a href="#formalization-of-multiscale-spatial-analysis" id="toc-formalization-of-multiscale-spatial-analysis" class="nav-link" data-scroll-target="#formalization-of-multiscale-spatial-analysis">4.&nbsp;Formalization of multiscale spatial analysis</a></li>
  <li><a href="#spatial-regression-ai-and-land-use-change-prediction" id="toc-spatial-regression-ai-and-land-use-change-prediction" class="nav-link" data-scroll-target="#spatial-regression-ai-and-land-use-change-prediction">5.&nbsp;Spatial regression, AI and land-use change prediction</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Research</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>I am an environmental economist who focuses on defining and assessing sustainability at global to local scales. Specifically, I focus on <strong>natural capital</strong> (the ecosystems, biodiversity and other economically-critical earth-systems processes) and <strong>ecosystem services</strong> (the valuable flow of services from natural capital to humans). My research informs environmental decision-making in contexts where the economy affects the environment, but also vice-versa, identifying where changes in ecosystem services have macroeconomic effects.</p>
<p>I have launched a new model combining the <a href="#0">Global Trade Analysis Project (GTAP)</a>&nbsp;computable general equilibrium model with&nbsp;the <a href="#0">Integrated Valuation of Ecosystem Services and Tradeoffs (InVEST)</a> model from the Natural Capital Project. This new model, GTAP-InVEST,&nbsp;builds on our <a href="#0">new work published in Science</a>&nbsp;that is able to calculate ecosystem service flows globally, at very high resolution (10m to 300m grid-cells), under a variety of future scenarios. These ecosystem services, in turn, are expressed as shocks to the global economy. Observing how the new economic equilibrium changes, we identify useful impacts from nature, such as effects on GDP, trade flows, employment and commodity prices.</p>
<p>We use GTAP-InVEST to answer a variety of important questions:</p>
<ul class="incremental">
<li>What does it take to attain the sustainable development goals? How do we even measure that?</li>
<li>What would broad implementation of commodity certification standards&nbsp;do to economic performance (and this would allow us to more precisely establish when and where the conservation benefit might be offset by changes in other countries or sectors.</li>
<li>What does an optimized global payments for ecosystem services policy look like?</li>
</ul>
<section id="research-overview" class="level1">
<h1>Research Overview</h1>
<p><em>Updated 2025.01.03.</em></p>
<p>My research builds on a strength within our department: economic analysis of natural capital and ecosystem services. Our department has one of the strongest reputations among all economics departments on this topic, as documented in our most recent departmental review, which argued that this research area should have increased investment. Although I collaborate frequently with the senior authors in our department who have built this reputation, my contribution is distinct on several fronts, which I will describe in the following four research threads.</p>
<section id="connecting-ecosystem-services-and-natural-capital-to-computable-general-equilibrium" class="level2">
<h2 class="anchored" data-anchor-id="connecting-ecosystem-services-and-natural-capital-to-computable-general-equilibrium">1. Connecting ecosystem services and natural capital to computable general equilibrium</h2>
<p>I launched and now lead the research team behind GTAP-InVEST, a new model that connects natural capital to macroeconomics at the global scale. Specifically, this model combines the Global Trade Analysis Project (GTAP) computable general equilibrium model with the Integrated Valuation of Ecosystem Services and Tradeoffs (InVEST) model, a high-resolution, process-based ecosystem model from the Natural Capital Project. Prior work on ecosystem services focused on partial equilibrium modeling and non-market valuation techniques. My work, conversely, considers how ecosystem services and natural capital affect the economy through general equilibrium effects, imputing the value of ecosystem services through shocks on the production system.</p>
<p>GTAP-InVEST builds on work I published with coauthors in Science (Chaplin-Kramer et al.&nbsp;2019) that was the first peer-reviewed work to calculate ecosystem services globally with high resolution data (300m grid-cells). Even before this work was published, I launched a parallel research effort that aimed to use these global ecosystem service estimates in a macroeconomic context to assess how valuable such services were to the broader economy. This work was originally published in two high-impact reports for the World Wildlife Fund (Johnson et al.&nbsp;2020) and the World Bank in “The Economic Case for Nature” (Johnson et al.&nbsp;2021). More recently, we published this work in the Proceedings of the National Academy of Science (Johnson et al.&nbsp;2023b), where we assessed five different sustainability policies and their effect on both ecosystem services macroeconomic activity. This allowed us to identify the impact of ecosystem services on indicators such as real GDP, trade flows, employment and commodity prices. Although this project started very recently, we have already seen exponential growth in the number of organizations interested in working with us and raised significant new funding, launching engagements with more than 10 multilateral development banks, sovereign wealth funds and federal reserve systems.</p>
<p>The approach used in GTAP-InVEST is deeply connected to Applied Economics and the assessment of land as a resource. We leveraged advances in computable general equilibrium (CGE) modeling, creating a new version of GTAP-AEZ (Agro-Ecological Zones) that differentiated land as an input to production based on the quality and availability of land for use as cropland, pastureland and managed forestry. Previous versions of GTAP-AEZ had assumed that the amount of land available to the economy was fixed, thus allowing different sectors to compete over its use, but not allowing conversion of natural land into economic use. We created and parameterized a novel land-supply function based on remotely-sensed data (Leijten et al.&nbsp;2023) that calibrated the elasticity of substitution uniquely for each region and AEZ. This innovation let us identify the opportunity cost of establishing protected areas and understand important equity implications for low-income countries.</p>
</section>
<section id="predicting-land-use-change-and-environmental-impacts" class="level2">
<h2 class="anchored" data-anchor-id="predicting-land-use-change-and-environmental-impacts">2. Predicting land-use change and environmental impacts</h2>
<p>The reason no previous models had linked ecosystem services to a global CGE is due both to the computational challenge of computing models at this scale (approximately 8 billion grid-cells) and because the models have to operate across different spatial scales. Although the GTAP-AEZ model we used was able to endogenously predict land-use change, this was only at the Region-AEZ level (n=341). To compute ecosystem services, conversely, we needed this data at 300-meter (or finer) resolution. In order to solve this challenge, I created a land-use change model, the Spatial Economic Allocation Landscape Simulator (SEALS) model, that could allocate regional estimates of land-use change to specific grid-cells at the appropriate resolution. This model used a time-series of land-use, land-cover (LULC) data from the European Space Agency, training the model on data from 1992 to 2010 and validating on the years 2010-2020. The underlying allocation algorithm defined flexible functional forms for 40 spatial covariates, including adjacency relationships between land-use classes, and then employed a stochastic gradient descent algorithm to define the coefficients that best predicted land-use change in the out-of-sample data.</p>
<p>The initial SEALS algorithm was described in Suh et al.&nbsp;(2020) and more recently in von Jeetze et al.&nbsp;(2023). It is worth noting that I have published many papers, such as these, which were led by a different author, but in which I was the technical and/or methodological expert that enabled the work. More broadly, this indicates that one of my important academic contributions is producing public goods research, software and algorithms (SEALS now has 14 active users). Since launching this research tract, I have expanded the SEALS model to include more sectors, including energy and extractives (Johnson et al.&nbsp;2021), and other land-intensive economic activities. This is important because the transition to renewable energy has a very large spatial footprint that could undermine other conservation objectives. We found, however, that because there is a high-degree of flexibility on where renewable energy could be cited (which is the opposite of fossil-fuel energy), it was possible to optimize renewable expansion to minimize environmental impact.</p>
<p>Critical to making good land-use change predictions with SEALS is the question of where agricultural expansion is possible and how this might change in the future. Very recent work, which I just published with coauthors in Nature Food (Gerber et al.&nbsp;2024), shows a high degree of spatial heterogeneity in where yield gaps exist and where future crop yield stagnation puts certain regions at risk. These results are already being used in SEALS to identify where land-use change might be exacerbated by lower-than-expected yields.</p>
</section>
<section id="advancing-ecosystem-service-methodology" class="level2">
<h2 class="anchored" data-anchor-id="advancing-ecosystem-service-methodology">3. Advancing ecosystem service methodology</h2>
<p>In addition to connecting ecosystem service modeling to economics, I have made many fundamental advances in the underlying approach to estimating ecosystem service value in three key areas: improving and expanding estimation methodology, working with large scale model intercomparison projects to conduct model ensemble and assessment activities, and increasing policy relevance of ecosystem service results. On the methodology front, one example contribution is from Johnson and Salemi (2022), in which I incorporated microeconomic decision rules in an agent-based simulation to assess how competition for a scarce public good (firewood) contributed to the value of forest ecosystems in Tanzania. Another example is from Thakrar, Johnson and Polasky (2023), in which we identify how ecosystems and corresponding land-use decisions have large impacts on air quality. We are currently in the process of coding this as an ecosystem service model in InVEST and then incorporating it as a shock to labor productivity into GTAP-InVEST.</p>
<p>I have also contributed extensively to many large-scale ecosystem service assessments and model intercomparison projects. For example, I was a key participant in the BES-SIM project reported recently in Science (Pereira et al.&nbsp;2024) that coordinated running of multiple different ecosystem service models on common input data to create ensemble results. Model intercomparison of this type has been an important part of the climate change modeling community and I have had the opportunity to push for this in the ecosystem services community to increase the clarity and validity of our models. In so doing, I have also been extensively involved in recent work to increase the number of ecosystem services that can be computed at the global scale, including in Neugarten et al.&nbsp;(2023), Isbell et al.&nbsp;(2023), Chaplin-Kramer et al.&nbsp;(2023), Mandle et al.&nbsp;(2021), and Kim et al.&nbsp;(2021), among others.</p>
<p>Finally, I have published several high-impact papers indicating how ecosystem service analysis can improve policy outcomes and how best to provide decision support to policy makers. For example, I led a project to create a new a new decision support tool named MESH (Mapping Ecosystem Services to Humans), documented in Johnson et al.&nbsp;(2019). This was used extensively in a Science for Nature and People Partnership (SNAPP) grant that used the model with 20 decision makers from ministries of finance and forestry in Burkina Faso, Ghana and Tanzania. This work also translated results from ecosystem service models into estimates of how different Sustainable Development Goals were affected, documented in another publication in which I was a co-lead author (Wood et al.&nbsp;2018).</p>
</section>
<section id="using-machine-learning-and-ai-to-accelerate-economic-sustainability-research" class="level2">
<h2 class="anchored" data-anchor-id="using-machine-learning-and-ai-to-accelerate-economic-sustainability-research">4. Using machine learning and AI to accelerate economic sustainability research</h2>
<p>As discussed above, I am the lead for Applied Economics on a successful National Science Foundation grant for $20,000,000 to launch the AI-CLIMATE institute at UMN. From this experience, using AI and machine learning has also become a key component of my research agenda. Starting with one of my earliest publications (Johnson et al.&nbsp;2014, PNAS), I have assessed how to optimize the tradeoff between food production and environmental quality. This research area has grown to incorporate solving for the optimal “tradeoff frontier” between multiple environmental and non-environmental goods, identifying where pareto-improving alterations to the landscape can be made. These tradeoff frontiers are very time-consuming to construct, however, and thereby have limited options for assessing uncertainty. I am currently leading a team within the AI-CLIMATE group to use AI-guided optimization methods that greatly accelerate identification of optimal outcomes. Another part of AI-CLIMATE central to my research is model emulation techniques, which use AI to create reduced-form approximations of more complex models, such as GTAP-InVEST. These emulated models can be run in near-real-time, enabling deeper exploration of complex solution spaces and improved integration with policymakers via decision-support tools.</p>
</section>
</section>
<section id="future-research-directions" class="level1">
<h1>Future research directions</h1>
<p>Each of the four research themes listed above have great potential for future research, which I will continue to pursue along with several new research directions. In this section, I outline five specific future research directions.</p>
<section id="new-methods-in-linking-general-equilibrium-to-earth-systems-models" class="level2">
<h2 class="anchored" data-anchor-id="new-methods-in-linking-general-equilibrium-to-earth-systems-models">1.&nbsp;New methods in linking general equilibrium to earth systems models</h2>
<p>In the Johnson-Polasky research lab (and soon under our new departmental center, NatCap TEEMs), we refer to a new type of work called Earth-Economy modeling. We define this type of model as one that combines general equilibrium modeling with high-resolution earth-systems modeling, defined with sufficient sectoral and spatial detail to do policy relevant analysis on global to local scales. There has been an explosion in interest in this type of work, but many new research challenges will need to be solved for this to keep progressing. First, I intend to convert our Earth-Economy model, GTAP-InVEST, to a recursive-dynamic formulation, rather than the current comparative-static approach. This is especially important when analyzing regime-changes and tipping points, which have become some of the most cited aspects of my prior work. It will also enable analysis of additional economic phenomena, such as endogenous capital accumulation and savings behavior. This research is well underway, supported by an ongoing grant from the World Bank and their Changing Wealth of Nations project. Second, I will increase the level of detail in the energy sectors in my model, with particular emphasis on renewable resources. In the paper I led in Ecological Economics (Johnson et al.&nbsp;2021), we showed that renewable energy has a large spatial footprint, which could undermine conservation objectives. For this work, we took projections from the International Energy Agency, but future work could instead model the expansion and contraction of different energy sectors endogenously by linking to GTAP-InVEST. My model is particularly well-suited for this type of work because it is one of the only global CGEs with endogenous competition over land. Third, I will incorporate explicit climate change emissions and damages into the model. We have already created a custom version of the DICE model and have incorporated it into GTAP-InVEST, but improved iterations will use more detailed climate integrated assessment models, like the FUND model. Finally, I expect to pair GTAP-InVEST with other types of models used throughout the economics discipline. Multiple central banks, including the U.S. Federal Reserve, have already reached out to me to inquire about linking my CGE approach with their monetary models and dynamic stochastic general equilibrium models. Their primary objective is to assess how resilient their banking polices are to large, systemic environmental shocks. Additionally, we have almost finalized another large contract with World Bank to connect our GTAP-InVEST model to their structural econometric fiscal model (MFMOD), which will further enhance the relevance of nature-aware macroeconomic modeling.</p>
</section>
<section id="what-is-possible-versus-how-to-get-there" class="level2">
<h2 class="anchored" data-anchor-id="what-is-possible-versus-how-to-get-there">2.&nbsp;What is possible versus how to get there?</h2>
<p>There are two parts of my research that, to date, have been separate but have great potential for being joined. The first part is research that creates pareto-efficiency curves to describe environmental and economic tradeoffs. These curves describe a range of efficient outcomes and show that when the current landscape is not on the efficiency frontier, there exist win-win improvements for environmental and economic objectives. Frontier analysis shows what is biophysically possible, but it does not specify how to move from the current, interior point in frontier space outwards towards efficient points. The second part of my research, CGE modeling work with GTAP-InVEST, is well-positioned to specify how different policies move us towards (or away) from efficient outcomes. Different policy scenarios, such as those assessed in our PNAS piece (Johnson et al.&nbsp;2023b), can be scored in frontier space to identify how or if they move towards more efficient outcomes. Combining natural efficiency frontiers with GTAP-InVEST will enable analysis of both what is possible and how to get there.</p>
</section>
<section id="natural-capital-accounting-and-private-sector-investing" class="level2">
<h2 class="anchored" data-anchor-id="natural-capital-accounting-and-private-sector-investing">3.&nbsp;Natural capital accounting and private sector investing</h2>
<p>Great interest has arisen from governmental and private sector agents who want to know how changes in natural capital and ecosystem services can be quantified as in accounting frameworks compatible with systems of national accounts (SNAs). The System of Environmental-Economic Accounting (SEEA) has grown in prominence, garnering support from President Biden in an executive order in 2022. I have already been involved in this work, participating in the first natural capital accounting working group hosted by the U.S. Geological Survey, and I intend to continue in this direction. One of the reasons why SNAs have been useful for guiding policy is that they define clear and consistent performance metrics (like Gross Domestic Product) that can be projected by forward-looking economic models, like CGEs. As natural capital accounting grows in importance, my nature-aware Earth-Economy model is well positioned to serve a similar role for environmental indicators. This type of information is also demanded by private firms, particularly investors, who want to know how their investment choices might be affected by degradation of natural capital. For example, the Norwegian Sovereign Wealth Fund and Central Bank have commissioned us to provide estimates of how changes in natural capital can be expressed as investment exposure for their funds. This work will continue, aiming to provide clear and methodologically rigorous estimates ready for use in corporate sustainability reporting.</p>
</section>
<section id="formalization-of-multiscale-spatial-analysis" class="level2">
<h2 class="anchored" data-anchor-id="formalization-of-multiscale-spatial-analysis">4.&nbsp;Formalization of multiscale spatial analysis</h2>
<p>I published an article in Environmental Research Letters (Johnson et al.&nbsp;2023a) that argued an important frontier in sustainability research was identifying cross-scale interactions in global-to-local research. In particular, I argued that many phenomena operate at a meso scale between global and local levels, and that often these effects are both important and hard to analyze. Since publishing this paper, I have become increasingly focused on quantifying how cross-scale analysis can raise important new insights. For example, most prior work in estimating the value of ecosystem services has focused on bottom-up analysis, including hedonic approaches, contingent valuation, replacement cost, and a variety of other approaches. These approaches, however, are hard to scale to global contexts while remaining consistent, especially when policies are very large and have general equilibrium effects. An alternative approach that I will explore is thinking about top-down identification of ecosystem service value. Specifically, with GTAP-InVEST, it is possible to impute the value of ecosystem services by calculating the change in welfare that occurs after a change in the provision of ecosystem services. For example, instead of estimating the value of pollination services by asking individual farmers how much they would be willing to pay for pollination, one could calculate the overall reduction in yield from reduced pollination services and input this as a shock into a general equilibrium model to calculate the reduction in sectoral profitability, GDP, or other relevant metrics.</p>
</section>
<section id="spatial-regression-ai-and-land-use-change-prediction" class="level2">
<h2 class="anchored" data-anchor-id="spatial-regression-ai-and-land-use-change-prediction">5.&nbsp;Spatial regression, AI and land-use change prediction</h2>
<p>Creating the SEALS algorithm, described above, was the key innovation that allowed linking GTAP to InVEST. The algorithm validates well on withheld data and performs the required task of increasing LULC resolution, but there is an opportunity to improve the accuracy of its predictions. SEALS represents spatial adjacency via convolutions (2-dimensional moving-window transformations) in its regression, but it does not take the logical next step of using a deep convolutional neural network. Convolutional neural networks are widely used in image processing and many other domains similar to land-use change prediction, and so they might hold promise for enhancing the accuracy of the SEALS predictions. More generally, however, there exist image-generation techniques that could improve predictions further, including the use of generative adversarial networks (GANs). Prior work in this area has assessed security implications for how GANs could be used to create false satellite imagery (Marín and Escalera, 2021), but I believe such approaches could be used not to falsify such imagery but to predict it. I intend to couple this with Knowledge Guided Machine Learning (KGML) techniques (e.g., Liu et al.&nbsp;2022), pioneered by the Principal Investigators of the AI-CLIMATE grant here at UMN, to push these methods towards producing LULC maps that provide both accurate, cross-validated predictions, but also improve how much they resemble the general spatial patterns evident from satellite data.</p>
<p>Spatial regression more generally also will be an important element of my future research. I recently published a book chapter (Weil, Johnson and Chaplin-Kramer, 2021) that highlights this direction, showing how a common machine learning algorithm, XGBOOST, could more accurately predict spatial patterns of crop production. Separately, I have developed algorithms that allow for regression on very large, gridded datasets. Most spatial regression models experience performance constraints when applied to datasets with more than 1,000 spatial points. By imposing structure on the spatial relationships between covariates, namely by defining them via different convolutions, it is possible to retain information on adjacency effects among variables while also scaling the size of the regression to millions of spatial points. This approach is already documented in a submitted manuscript and will be supported by R and Python packages to assist others in implementing these algorithms.</p>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p>Chaplin-Kramer, Rebecca, Rachel A. Neugarten, Richard P. Sharp, Pamela M. Collins, Stephen Polasky, David Hole, Richard Schuster, et al.&nbsp;“Mapping the Planet’s Critical Natural Assets.” <em>Nature Ecology &amp; Evolution</em> 7, no. 1 (January 2023): 51–61. <a href="https://doi.org/10.1038/s41559-022-01934-5" class="uri">https://doi.org/10.1038/s41559-022-01934-5</a>.</p>
<p>Chaplin-Kramer, Rebecca, Richard P. Sharp, Charlotte Weil, Elena M. Bennett, Unai Pascual, Katie K. Arkema, Kate A. Brauman, et al.&nbsp;“Global Modeling of Nature’s Contributions to People.” <em>Science</em> 366, no. 6462 (October 11, 2019): 255–58. <a href="https://doi.org/10.1126/science.aaw3372" class="uri">https://doi.org/10.1126/science.aaw3372</a>.</p>
<p>Gerber, James S., Deepak K. Ray, David Makowski, Ethan E. Butler, Nathaniel D. Mueller, Paul C. West, Justin A. Johnson, et al.&nbsp;“Global Spatially Explicit Yield Gap Time Trends Reveal Regions at Risk of Future Crop Yield Stagnation.” <em>Nature Food</em> 5, no. 2 (February 2024): 125–35. <a href="https://doi.org/10.1038/s43016-023-00913-8" class="uri">https://doi.org/10.1038/s43016-023-00913-8</a>.</p>
<p>Jeetze, Patrick José von, Isabelle Weindl, Justin Andrew Johnson, Pasquale Borrelli, Panos Panagos, Edna J. Molina Bacca, Kristine Karstens, et al.&nbsp;“Projected Landscape-Scale Repercussions of Global Action for Climate and Biodiversity Protection.” <em>Nature Communications</em> 14, no. 1 (May 16, 2023): 2515. <a href="https://doi.org/10.1038/s41467-023-38043-1" class="uri">https://doi.org/10.1038/s41467-023-38043-1</a>.</p>
<p>Johnson, Justin A., Christina M. Kennedy, James R. Oakleaf, Sharon Baruch-Mordo, Stephen Polasky, and Joseph Kiesecker. “Energy Matters: Mitigating the Impacts of Future Land Expansion Will Require Managing Energy and Extractive Footprints.” <em>Ecological Economics</em> 187 (September 1, 2021): 107106. <a href="https://doi.org/10.1016/j.ecolecon.2021.107106" class="uri">https://doi.org/10.1016/j.ecolecon.2021.107106</a>.</p>
<p>Johnson, Justin Andrew, and Colette Salemi. “Agents on a Landscape: Simulating Spatial and Temporal Interactions in Economic and Ecological Systems.” <em>Frontiers in Ecology and Evolution</em> 10 (2022). <a href="https://www.frontiersin.org/articles/10.3389/fevo.2022.845435" class="uri">https://www.frontiersin.org/articles/10.3389/fevo.2022.845435</a>.</p>
<p>Johnson, Justin Andrew, Carlisle Ford Runge, Benjamin Senauer, Jonathan Foley, and Stephen Polasky. “Global Agriculture and Carbon Trade-Offs.” <em>Proceedings of the National Academy of Sciences</em> 111, no. 34 (August 26, 2014): 12342–47. <a href="https://doi.org/10.1073/pnas.1412835111" class="uri">https://doi.org/10.1073/pnas.1412835111</a>.</p>
<p>Johnson, Justin Andrew, Giovanni Ruta, Uris Lantz Baldos, Raffaello Cervigni, Shun Chonabayashi, Erwin Corong, Olga Gavryliuk, et al.&nbsp;“The Economic Case for Nature: A Global Earth-Economy Model to Assess Development Policy Pathways.” Washington, DC: World Bank, June 29, 2021. <a href="https://openknowledge.worldbank.org/handle/10986/35882" class="uri">https://openknowledge.worldbank.org/handle/10986/35882</a>.</p>
<p>Johnson, Justin Andrew, Molly E. Brown, Erwin Corong, Jan Philipp Dietrich, Roslyn C. Henry, Patrick José von Jeetze, David Leclère, Alexander Popp, Sumil K. Thakrar, and David R. Williams. “The Meso Scale as a Frontier in Interdisciplinary Modeling of Sustainability from Local to Global Scales.” <em>Environmental Research Letters</em> 18, no. 2 (February 2023a): 025007. <a href="https://doi.org/10.1088/1748-9326/acb503" class="uri">https://doi.org/10.1088/1748-9326/acb503</a>.</p>
<p>Johnson, Justin Andrew, Uris Lantz Baldos, Erwin Corong, Thomas Hertel, Stephen Polasky, Raffaello Cervigni, Toby Roxburgh, Giovanni Ruta, Colette Salemi, and Sumil Thakrar. “Investing in Nature Can Improve Equity and Economic Returns.” <em>Proceedings of the National Academy of Sciences</em> 120, no. 27 (July 4, 2023b): e2220401120. <a href="https://doi.org/10.1073/pnas.2220401120" class="uri">https://doi.org/10.1073/pnas.2220401120</a>.</p>
<p>Johnson, Justin, Uris Lantz Baldos, Thomas Hertel, Chris Nootenboom, Stephen Polasky, and Toby Roxburgh. “Global Futures: Modelling the Global Economic Impacts of Environmental Change to Support Policy-Making - Technical Report.” WWF UK. WWF UK. WWF UK, 2020. <a href="http://www.gtap.agecon.purdue.edu/resources/res_display.asp?RecordID=6186" class="uri">http://www.gtap.agecon.purdue.edu/resources/res_display.asp?RecordID=6186</a>.</p>
<p>Kim, HyeJin, Garry Peterson, William Cheung, Simon Ferrier, Rob Alkemade, Almut Arneth, Jan J. Kuiper, et al.&nbsp;“Towards a Better Future for Biodiversity and People: Modelling Nature Futures.” SocArXiv, July 22, 2021. <a href="https://doi.org/10.31235/osf.io/93sqp" class="uri">https://doi.org/10.31235/osf.io/93sqp</a>.</p>
<p>Kim, HyeJin, Isabel M. D. Rosa, Rob Alkemade, Paul Leadley, George Hurtt, Alexander Popp, Detlef P. van Vuuren, et al.&nbsp;“A Protocol for an Intercomparison of Biodiversity and Ecosystem Services Models Using Harmonized Land-Use and Climate Scenarios.” <em>Geoscientific Model Development</em> 11, no. 11 (November 13, 2018): 4537–62. <a href="https://doi.org/10.5194/gmd-11-4537-2018" class="uri">https://doi.org/10.5194/gmd-11-4537-2018</a>.</p>
<p>Leijten, Floris, Uris Lantz C Baldos, Justin A. Johnson, Sarah Sim, and Peter H. Verburg. “Projecting Global Oil Palm Expansion under Zero-Deforestation Commitments: Direct and Indirect Land Use Change Impacts.” <em>iScience</em> 26, no. 6 (June 2023): 106971. <a href="https://doi.org/10.1016/j.isci.2023.106971" class="uri">https://doi.org/10.1016/j.isci.2023.106971</a>.</p>
<p>Liu, Licheng, Shaoming Xu, Jinyun Tang, Kaiyu Guan, Timothy J. Griffis, Matthew D. Erickson, Alexander L. Frie, et al.&nbsp;“KGML-Ag: A Modeling Framework of Knowledge-Guided Machine Learning to Simulate Agroecosystems: A Case Study of Estimating N<sub>2</sub>O Emission Using Data from Mesocosm Experiments.” <em>Geoscientific Model Development</em> 15, no. 7 (April 7, 2022): 2839–58. <a href="https://doi.org/10.5194/gmd-15-2839-2022" class="uri">https://doi.org/10.5194/gmd-15-2839-2022</a>.</p>
<p>Mandle, Lisa, Analisa Shields-Estrada, Rebecca Chaplin-Kramer, Matthew G. E. Mitchell, Leah L. Bremer, Jesse D. Gourevitch, Peter Hawthorne, et al.&nbsp;“Increasing Decision Relevance of Ecosystem Service Science.” <em>Nature Sustainability</em> 4, no. 2 (February 2021): 161–69. <a href="https://doi.org/10.1038/s41893-020-00625-y" class="uri">https://doi.org/10.1038/s41893-020-00625-y</a>.</p>
<p>Marín, Javier, and Sergio Escalera. “SSSGAN: Satellite Style and Structure Generative Adversarial Networks.” <em>Remote Sensing</em> 13, no. 19 (January 2021): 3984. <a href="https://doi.org/10.3390/rs13193984" class="uri">https://doi.org/10.3390/rs13193984</a>.</p>
<p>Neugarten, Rachel A., Rebecca Chaplin-Kramer, Richard P. Sharp, Richard Schuster, Matthew Strimas-Mackey, Patrick R. Roehrdanz, Mark Mulligan, et al.&nbsp;“Mapping the Planet’s Critical Areas for Biodiversity and Nature’s Contributions to People.” <em>Nature Communications</em> 15, no. 1 (January 10, 2024): 261. <a href="https://doi.org/10.1038/s41467-023-43832-9" class="uri">https://doi.org/10.1038/s41467-023-43832-9</a>.</p>
<p>Pereira, Henrique M., Inês S. Martins, Isabel M. D. Rosa, HyeJin Kim, Paul Leadley, Alexander Popp, Detlef P. van Vuuren, et al.&nbsp;“Global Trends and Scenarios for Terrestrial Biodiversity and Ecosystem Services from 1900 to 2050.” <em>Science</em> 384, no. 6694 (April 26, 2024): 458–65. <a href="https://doi.org/10.1126/science.adn3441" class="uri">https://doi.org/10.1126/science.adn3441</a>.</p>
<p>Suh, Sangwon, Justin A. Johnson, Lau Tambjerg, Sarah Sim, Summer Broeckx-Smith, Whitney Reyes, and Rebecca Chaplin-Kramer. “Closing Yield Gap Is Crucial to Avoid Potential Surge in Global Carbon Emissions.” <em>Global Environmental Change</em> 63 (July 2020): 102100. <a href="https://doi.org/10.1016/j.gloenvcha.2020.102100" class="uri">https://doi.org/10.1016/j.gloenvcha.2020.102100</a>.</p>
<p>Thakrar, Sumil K., Justin A. Johnson, and Stephen Polasky. “Land-Use Decisions Have Substantial Air Quality Health Effects.” <em>Environmental Science &amp; Technology</em> 58, no. 1 (January 9, 2024): 381–90. <a href="https://doi.org/10.1021/acs.est.3c02280" class="uri">https://doi.org/10.1021/acs.est.3c02280</a>.</p>
<p>Weil, Charlotte, Justin Johnson, Romain Caristan, Kate Brauman, Benjamin Bodirsky, Mika Jalava, Matti Kummu, et al.&nbsp;“Resilience of Food Sufficiency to Future Climate and Societal Changes.” Preprint. In Review, January 12, 2021. <a href="https://doi.org/10.21203/rs.3.rs-135121/v1" class="uri">https://doi.org/10.21203/rs.3.rs-135121/v1</a>.</p>
<p>Wood, Sylvia L. R., Sarah K. Jones, Justin A. Johnson, Kate A. Brauman, Rebecca Chaplin-Kramer, Alexander Fremier, Evan Girvetz, et al.&nbsp;“Distilling the Role of Ecosystem Services in the Sustainable Development Goals.” <em>Ecosystem Services</em> 29 (February 1, 2018): 70–82. <a href="https://doi.org/10.1016/j.ecoser.2017.10.010" class="uri">https://doi.org/10.1016/j.ecoser.2017.10.010</a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>