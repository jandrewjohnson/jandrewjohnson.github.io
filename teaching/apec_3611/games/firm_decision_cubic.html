<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firm Decision Making: Profit Maximization</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #f5f7fa;
            color: #2d3748;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            font-weight: 400;
            font-size: 1.8rem;
            margin-bottom: 8px;
            color: #1a202c;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr 340px;
            gap: 20px;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 800px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .graph-container {
            background: #ffffff;
            border-radius: 12px;
            padding: 15px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        
        .graph-title {
            text-align: center;
            font-size: 0.95rem;
            color: #1a202c;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        canvas {
            display: block;
            width: 100%;
            height: auto;
            border-radius: 8px;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }
        
        .control-panel {
            background: #ffffff;
            border-radius: 12px;
            padding: 16px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        
        .control-panel.highlight {
            border: 2px solid #38a169;
            background: linear-gradient(135deg, rgba(56, 161, 105, 0.05) 0%, #ffffff 100%);
        }
        
        .panel-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #718096;
            margin-bottom: 14px;
            font-weight: 600;
        }
        
        .panel-title.price {
            color: #38a169;
        }
        
        .slider-group {
            margin-bottom: 14px;
        }
        
        .slider-group:last-child {
            margin-bottom: 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.85rem;
            color: #4a5568;
        }
        
        .slider-value {
            background: #edf2f7;
            padding: 3px 10px;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8rem;
            color: #2b6cb0;
            font-weight: 500;
        }
        
        .slider-value.price {
            color: #38a169;
        }
        
        .slider-value.large {
            font-size: 1rem;
            padding: 5px 12px;
            color: #319795;
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4299e1;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(66, 153, 225, 0.3);
        }
        
        input[type="range"].price-slider::-webkit-slider-thumb {
            background: #38a169;
            box-shadow: 0 2px 6px rgba(56, 161, 105, 0.4);
        }
        
        .info-box {
            background: #f7fafc;
            border-radius: 8px;
            padding: 14px;
            border-left: 3px solid #319795;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 0.85rem;
        }
        
        .info-label {
            color: #718096;
        }
        
        .info-value {
            font-family: 'Monaco', 'Consolas', monospace;
            color: #1a202c;
        }
        
        .info-value.highlight {
            color: #d69e2e;
            font-weight: 600;
        }
        
        .info-value.profit {
            color: #38a169;
            font-weight: 600;
        }
        
        .info-value.loss {
            color: #e53e3e;
            font-weight: 600;
        }
        
        .equation-box {
            background: #f7fafc;
            border-radius: 8px;
            padding: 12px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8rem;
            color: #4a5568;
            text-align: center;
            margin-top: 10px;
            border: 1px solid #e2e8f0;
            line-height: 1.6;
        }
        
        .legend {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 12px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: #4a5568;
        }
        
        .legend-line {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }
        
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .profit-display {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }
        
        .profit-display.positive {
            background: rgba(56, 161, 105, 0.1);
            border: 1px solid rgba(56, 161, 105, 0.3);
        }
        
        .profit-display.negative {
            background: rgba(229, 62, 62, 0.1);
            border: 1px solid rgba(229, 62, 62, 0.3);
        }
        
        .profit-display.zero {
            background: rgba(214, 158, 46, 0.1);
            border: 1px solid rgba(214, 158, 46, 0.3);
        }
        
        .profit-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #718096;
            margin-bottom: 5px;
        }
        
        .profit-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'Monaco', 'Consolas', monospace;
        }
        
        .profit-value.positive {
            color: #38a169;
        }
        
        .profit-value.negative {
            color: #e53e3e;
        }
        
        .profit-value.zero {
            color: #d69e2e;
        }
        
        .decision-box {
            background: #f7fafc;
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            font-size: 0.85rem;
            line-height: 1.5;
            border: 1px solid #e2e8f0;
        }
        
        .decision-box strong {
            color: #319795;
        }
        
        .decision-box .produce {
            color: #38a169;
            font-weight: 600;
        }
        
        .decision-box .shutdown {
            color: #e53e3e;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè≠ Firm Decision Making: Profit Maximization</h1>
        <p class="subtitle">See how a competitive firm chooses output to maximize profit where MR = MC</p>
        
        <div class="main-content">
            <div class="graph-container">
                <div class="graph-title">Total Revenue & Total Cost</div>
                <canvas id="total-canvas" width="500" height="450"></canvas>
            </div>
            
            <div class="graph-container">
                <div class="graph-title">Cost Curves & Profit Maximization</div>
                <canvas id="cost-canvas" width="500" height="450"></canvas>
            </div>
            
            <div class="controls">
                <div class="control-panel highlight">
                    <div class="panel-title price">üìà Market Price</div>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>Price (P)</span>
                            <span class="slider-value price" id="price-value">$15.00</span>
                        </div>
                        <input type="range" class="price-slider" id="price" min="2" max="40" value="15" step="0.5">
                    </div>
                    <div class="equation-box">
                        P = MR = AR (price taker)
                    </div>
                </div>
                
                <div class="control-panel">
                    <div class="panel-title">Cost Structure</div>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>Fixed Cost (FC)</span>
                            <span class="slider-value" id="fc-value">$30</span>
                        </div>
                        <input type="range" id="fc" min="0" max="100" value="30" step="5">
                    </div>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>Linear Cost (a)</span>
                            <span class="slider-value" id="a-value">$2.00</span>
                        </div>
                        <input type="range" id="a-param" min="0" max="8" value="2" step="0.25">
                    </div>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>Quadratic (b)</span>
                            <span class="slider-value" id="b-value">0.10</span>
                        </div>
                        <input type="range" id="b-param" min="0" max="0.5" value="0.1" step="0.01">
                    </div>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>Cubic (c) - Curvature</span>
                            <span class="slider-value" id="c-value">0.020</span>
                        </div>
                        <input type="range" id="c-param" min="0" max="0.1" value="0.02" step="0.002">
                    </div>
                    <div class="equation-box">
                        TC = FC + aQ + bQ¬≤ + cQ¬≥<br>
                        MC = a + 2bQ + 3cQ¬≤
                    </div>
                </div>
                
                <div class="control-panel">
                    <div class="panel-title">Optimal Decision</div>
                    <div class="info-box">
                        <div class="info-row">
                            <span class="info-label">Optimal Q*</span>
                            <span class="info-value highlight" id="opt-q">10.0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Revenue</span>
                            <span class="info-value" id="total-revenue">$150</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Cost</span>
                            <span class="info-value" id="total-cost">$80</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ATC at Q*</span>
                            <span class="info-value" id="atc-at-q">$8.00</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">AVC at Q*</span>
                            <span class="info-value" id="avc-at-q">$5.00</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">MC at Q*</span>
                            <span class="info-value" id="mc-at-q">$15.00</span>
                        </div>
                    </div>
                    
                    <div class="profit-display positive" id="profit-display">
                        <div class="profit-label">Economic Profit</div>
                        <div class="profit-value positive" id="profit-value">$70.00</div>
                    </div>
                    
                    <div class="decision-box" id="decision-box">
                        <strong>Decision:</strong> <span class="produce">PRODUCE</span> ‚Äî Price exceeds ATC. Firm earns economic profit!
                    </div>
                </div>
                
                <div class="control-panel">
                    <div class="panel-title">Legend</div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-line" style="background: #38a169;"></div>
                            <span>Price / MR</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line" style="background: #e53e3e;"></div>
                            <span>MC (Marginal Cost)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line" style="background: #805ad5;"></div>
                            <span>ATC (Avg Total Cost)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-line" style="background: #d69e2e;"></div>
                            <span>AVC (Avg Variable Cost)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #319795;"></div>
                            <span>Profit Max (MR=MC)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const totalCanvas = document.getElementById('total-canvas');
        const costCanvas = document.getElementById('cost-canvas');
        const totalCtx = totalCanvas.getContext('2d');
        const costCtx = costCanvas.getContext('2d');
        
        const margin = { top: 40, right: 30, bottom: 50, left: 60 };
        
        // Get slider elements
        const priceSlider = document.getElementById('price');
        const fcSlider = document.getElementById('fc');
        const aSlider = document.getElementById('a-param');
        const bSlider = document.getElementById('b-param');
        const cSlider = document.getElementById('c-param');
        
        // Cost functions with cubic form: TC = FC + aQ + bQ¬≤ + cQ¬≥
        function totalCost(Q, FC, a, b, c) {
            return FC + a * Q + b * Q * Q + c * Q * Q * Q;
        }
        
        function variableCost(Q, a, b, c) {
            return a * Q + b * Q * Q + c * Q * Q * Q;
        }
        
        // MC = dTC/dQ = a + 2bQ + 3cQ¬≤
        function marginalCost(Q, a, b, c) {
            return a + 2 * b * Q + 3 * c * Q * Q;
        }
        
        function ATC(Q, FC, a, b, c) {
            if (Q <= 0) return Infinity;
            return totalCost(Q, FC, a, b, c) / Q;
        }
        
        function AVC(Q, a, b, c) {
            if (Q <= 0) return Infinity;
            return variableCost(Q, a, b, c) / Q;
        }
        
        // Find Q where P = MC: P = a + 2bQ + 3cQ¬≤
        // 3cQ¬≤ + 2bQ + (a - P) = 0
        // Use quadratic formula
        function optimalQ(P, a, b, c) {
            if (c === 0 && b === 0) {
                // MC = a (constant), only produce if P >= a
                return P >= a ? 20 : 0; // arbitrary max
            }
            if (c === 0) {
                // MC = a + 2bQ, linear
                // P = a + 2bQ => Q = (P - a) / (2b)
                const q = (P - a) / (2 * b);
                return Math.max(0, q);
            }
            // Quadratic: 3cQ¬≤ + 2bQ + (a - P) = 0
            const A = 3 * c;
            const B = 2 * b;
            const C = a - P;
            const discriminant = B * B - 4 * A * C;
            
            if (discriminant < 0) return 0;
            
            const q1 = (-B + Math.sqrt(discriminant)) / (2 * A);
            const q2 = (-B - Math.sqrt(discriminant)) / (2 * A);
            
            // We want the positive solution where MC is increasing (upward sloping part)
            // MC' = 2b + 6cQ > 0 when Q > -b/(3c)
            // For typical values, we want the larger positive root
            const validQ = Math.max(q1, q2);
            return Math.max(0, validQ);
        }
        
        // Find minimum AVC: AVC = a + bQ + cQ¬≤
        // dAVC/dQ = b + 2cQ = 0 => Q = -b/(2c)
        // If c = 0, AVC = a + bQ, minimum at Q = 0
        function minAVCPoint(a, b, c) {
            if (c <= 0) return { q: 0, avc: a };
            const qMin = -b / (2 * c);
            if (qMin <= 0) return { q: 0, avc: a };
            const avcMin = AVC(qMin, a, b, c);
            return { q: qMin, avc: avcMin };
        }
        
        function drawTotalGraph() {
            const P = parseFloat(priceSlider.value);
            const FC = parseFloat(fcSlider.value);
            const a = parseFloat(aSlider.value);
            const b = parseFloat(bSlider.value);
            const c = parseFloat(cSlider.value);
            
            const qStar = optimalQ(P, a, b, c);
            
            totalCtx.fillStyle = '#ffffff';
            totalCtx.fillRect(0, 0, totalCanvas.width, totalCanvas.height);
            
            const width = totalCanvas.width - margin.left - margin.right;
            const height = totalCanvas.height - margin.top - margin.bottom;
            const maxQ = 25;
            const maxVal = 600;
            
            const toX = (q) => margin.left + (q / maxQ) * width;
            const toY = (v) => margin.top + height - (v / maxVal) * height;
            
            // Grid
            totalCtx.strokeStyle = '#edf2f7';
            totalCtx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const x = margin.left + (i / 5) * width;
                const y = margin.top + (i / 5) * height;
                totalCtx.beginPath();
                totalCtx.moveTo(x, margin.top);
                totalCtx.lineTo(x, margin.top + height);
                totalCtx.stroke();
                totalCtx.beginPath();
                totalCtx.moveTo(margin.left, y);
                totalCtx.lineTo(margin.left + width, y);
                totalCtx.stroke();
            }
            
            // Axes
            totalCtx.strokeStyle = '#a0aec0';
            totalCtx.lineWidth = 2;
            totalCtx.beginPath();
            totalCtx.moveTo(margin.left, margin.top);
            totalCtx.lineTo(margin.left, margin.top + height);
            totalCtx.lineTo(margin.left + width, margin.top + height);
            totalCtx.stroke();
            
            // Axis labels
            totalCtx.fillStyle = '#718096';
            totalCtx.font = '11px Segoe UI';
            totalCtx.textAlign = 'center';
            for (let i = 0; i <= 5; i++) {
                const q = (i / 5) * maxQ;
                totalCtx.fillText(q.toFixed(0), toX(q), margin.top + height + 18);
            }
            totalCtx.textAlign = 'right';
            for (let i = 0; i <= 6; i++) {
                const v = (i / 6) * maxVal;
                totalCtx.fillText(`$${v.toFixed(0)}`, margin.left - 5, toY(v) + 4);
            }
            
            // Axis titles
            totalCtx.fillStyle = '#4a5568';
            totalCtx.font = '13px Segoe UI';
            totalCtx.textAlign = 'center';
            totalCtx.fillText('Quantity (Q)', margin.left + width / 2, totalCanvas.height - 8);
            totalCtx.save();
            totalCtx.translate(16, margin.top + height / 2);
            totalCtx.rotate(-Math.PI / 2);
            totalCtx.fillText('$ Total', 0, 0);
            totalCtx.restore();
            
            // Profit area (between TR and TC at Q*)
            if (qStar > 0 && qStar <= maxQ) {
                const TR_star = P * qStar;
                const TC_star = totalCost(qStar, FC, a, b, c);
                
                if (TR_star > TC_star) {
                    // Profit region
                    totalCtx.fillStyle = 'rgba(56, 161, 105, 0.15)';
                    totalCtx.beginPath();
                    totalCtx.moveTo(toX(0), toY(FC));
                    for (let q = 0; q <= qStar; q += 0.5) {
                        totalCtx.lineTo(toX(q), toY(totalCost(q, FC, a, b, c)));
                    }
                    totalCtx.lineTo(toX(qStar), toY(P * qStar));
                    for (let q = qStar; q >= 0; q -= 0.5) {
                        totalCtx.lineTo(toX(q), toY(P * q));
                    }
                    totalCtx.closePath();
                    totalCtx.fill();
                } else if (TC_star > TR_star) {
                    // Loss region
                    totalCtx.fillStyle = 'rgba(229, 62, 62, 0.1)';
                    totalCtx.beginPath();
                    totalCtx.moveTo(toX(0), toY(0));
                    for (let q = 0; q <= qStar; q += 0.5) {
                        totalCtx.lineTo(toX(q), toY(P * q));
                    }
                    totalCtx.lineTo(toX(qStar), toY(totalCost(qStar, FC, a, b, c)));
                    for (let q = qStar; q >= 0; q -= 0.5) {
                        totalCtx.lineTo(toX(q), toY(totalCost(q, FC, a, b, c)));
                    }
                    totalCtx.closePath();
                    totalCtx.fill();
                }
            }
            
            // Total Revenue line (TR = P * Q)
            totalCtx.strokeStyle = '#38a169';
            totalCtx.lineWidth = 3;
            totalCtx.beginPath();
            totalCtx.moveTo(toX(0), toY(0));
            for (let q = 0; q <= maxQ; q += 0.5) {
                const tr = P * q;
                if (tr <= maxVal) {
                    totalCtx.lineTo(toX(q), toY(tr));
                }
            }
            totalCtx.stroke();
            
            // Total Cost curve
            totalCtx.strokeStyle = '#e53e3e';
            totalCtx.lineWidth = 3;
            totalCtx.beginPath();
            totalCtx.moveTo(toX(0), toY(FC));
            for (let q = 0; q <= maxQ; q += 0.3) {
                const tc = totalCost(q, FC, a, b, c);
                if (tc <= maxVal) {
                    totalCtx.lineTo(toX(q), toY(tc));
                }
            }
            totalCtx.stroke();
            
            // Variable Cost curve
            totalCtx.strokeStyle = '#d69e2e';
            totalCtx.lineWidth = 2;
            totalCtx.setLineDash([5, 3]);
            totalCtx.beginPath();
            totalCtx.moveTo(toX(0), toY(0));
            for (let q = 0; q <= maxQ; q += 0.3) {
                const vc = variableCost(q, a, b, c);
                if (vc <= maxVal) {
                    totalCtx.lineTo(toX(q), toY(vc));
                }
            }
            totalCtx.stroke();
            totalCtx.setLineDash([]);
            
            // Optimal point
            if (qStar > 0 && qStar <= maxQ) {
                const TR_star = P * qStar;
                const TC_star = totalCost(qStar, FC, a, b, c);
                
                // Vertical line at Q*
                totalCtx.strokeStyle = '#a0aec0';
                totalCtx.lineWidth = 1;
                totalCtx.setLineDash([5, 3]);
                totalCtx.beginPath();
                totalCtx.moveTo(toX(qStar), toY(0));
                totalCtx.lineTo(toX(qStar), toY(Math.max(TR_star, TC_star)));
                totalCtx.stroke();
                totalCtx.setLineDash([]);
                
                // Points on TR and TC
                if (TR_star <= maxVal) {
                    totalCtx.fillStyle = '#38a169';
                    totalCtx.beginPath();
                    totalCtx.arc(toX(qStar), toY(TR_star), 6, 0, Math.PI * 2);
                    totalCtx.fill();
                    totalCtx.strokeStyle = '#ffffff';
                    totalCtx.lineWidth = 2;
                    totalCtx.stroke();
                }
                
                if (TC_star <= maxVal) {
                    totalCtx.fillStyle = '#e53e3e';
                    totalCtx.beginPath();
                    totalCtx.arc(toX(qStar), toY(TC_star), 6, 0, Math.PI * 2);
                    totalCtx.fill();
                    totalCtx.strokeStyle = '#ffffff';
                    totalCtx.lineWidth = 2;
                    totalCtx.stroke();
                }
            }
            
            // Labels
            totalCtx.font = 'bold 11px Segoe UI';
            totalCtx.fillStyle = '#38a169';
            totalCtx.textAlign = 'left';
            totalCtx.fillText('TR = P¬∑Q', toX(maxQ * 0.7), toY(P * maxQ * 0.7) - 8);
            totalCtx.fillStyle = '#e53e3e';
            totalCtx.fillText('TC', toX(maxQ * 0.85), toY(totalCost(maxQ * 0.85, FC, a, b, c)) - 8);
            totalCtx.fillStyle = '#d69e2e';
            totalCtx.fillText('VC', toX(maxQ * 0.9), toY(variableCost(maxQ * 0.9, a, b, c)) - 8);
            
            // Fixed cost label
            totalCtx.fillStyle = '#718096';
            totalCtx.font = '10px Segoe UI';
            totalCtx.textAlign = 'left';
            totalCtx.fillText(`FC = $${FC}`, margin.left + 5, toY(FC) - 5);
        }
        
        function drawCostGraph() {
            const P = parseFloat(priceSlider.value);
            const FC = parseFloat(fcSlider.value);
            const a = parseFloat(aSlider.value);
            const b = parseFloat(bSlider.value);
            const c = parseFloat(cSlider.value);
            
            const qStar = optimalQ(P, a, b, c);
            
            costCtx.fillStyle = '#ffffff';
            costCtx.fillRect(0, 0, costCanvas.width, costCanvas.height);
            
            const width = costCanvas.width - margin.left - margin.right;
            const height = costCanvas.height - margin.top - margin.bottom;
            const maxQ = 25;
            const maxCost = 50;
            
            const toX = (q) => margin.left + (q / maxQ) * width;
            const toY = (cost) => margin.top + height - (cost / maxCost) * height;
            
            // Grid
            costCtx.strokeStyle = '#edf2f7';
            costCtx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const x = margin.left + (i / 5) * width;
                const y = margin.top + (i / 5) * height;
                costCtx.beginPath();
                costCtx.moveTo(x, margin.top);
                costCtx.lineTo(x, margin.top + height);
                costCtx.stroke();
                costCtx.beginPath();
                costCtx.moveTo(margin.left, y);
                costCtx.lineTo(margin.left + width, y);
                costCtx.stroke();
            }
            
            // Axes
            costCtx.strokeStyle = '#a0aec0';
            costCtx.lineWidth = 2;
            costCtx.beginPath();
            costCtx.moveTo(margin.left, margin.top);
            costCtx.lineTo(margin.left, margin.top + height);
            costCtx.lineTo(margin.left + width, margin.top + height);
            costCtx.stroke();
            
            // Axis labels
            costCtx.fillStyle = '#718096';
            costCtx.font = '11px Segoe UI';
            costCtx.textAlign = 'center';
            for (let i = 0; i <= 5; i++) {
                const q = (i / 5) * maxQ;
                costCtx.fillText(q.toFixed(0), toX(q), margin.top + height + 18);
            }
            costCtx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const cost = (i / 5) * maxCost;
                costCtx.fillText(`$${cost.toFixed(0)}`, margin.left - 5, toY(cost) + 4);
            }
            
            // Axis titles
            costCtx.fillStyle = '#4a5568';
            costCtx.font = '13px Segoe UI';
            costCtx.textAlign = 'center';
            costCtx.fillText('Quantity (Q)', margin.left + width / 2, costCanvas.height - 8);
            costCtx.save();
            costCtx.translate(16, margin.top + height / 2);
            costCtx.rotate(-Math.PI / 2);
            costCtx.fillText('$ per unit', 0, 0);
            costCtx.restore();
            
            // Draw profit/loss area
            if (qStar > 0 && qStar <= maxQ) {
                const atcAtQ = ATC(qStar, FC, a, b, c);
                const avcAtQ = AVC(qStar, a, b, c);
                
                if (P > atcAtQ && atcAtQ <= maxCost && P <= maxCost) {
                    // Profit area (green)
                    costCtx.fillStyle = 'rgba(56, 161, 105, 0.2)';
                    costCtx.fillRect(toX(0), toY(P), toX(qStar) - toX(0), toY(atcAtQ) - toY(P));
                } else if (P < atcAtQ && P >= avcAtQ && atcAtQ <= maxCost && P <= maxCost) {
                    // Loss area but still producing
                    costCtx.fillStyle = 'rgba(229, 62, 62, 0.15)';
                    costCtx.fillRect(toX(0), toY(atcAtQ), toX(qStar) - toX(0), toY(P) - toY(atcAtQ));
                }
            }
            
            // Price / MR line (horizontal)
            if (P <= maxCost) {
                costCtx.strokeStyle = '#38a169';
                costCtx.lineWidth = 3;
                costCtx.beginPath();
                costCtx.moveTo(margin.left, toY(P));
                costCtx.lineTo(margin.left + width, toY(P));
                costCtx.stroke();
                
                costCtx.fillStyle = '#38a169';
                costCtx.font = 'bold 11px Segoe UI';
                costCtx.textAlign = 'right';
                costCtx.fillText('P = MR', margin.left + width - 5, toY(P) - 5);
            }
            
            // MC curve (exponentially increasing due to cubic term)
            costCtx.strokeStyle = '#e53e3e';
            costCtx.lineWidth = 3;
            costCtx.beginPath();
            let started = false;
            for (let q = 0.5; q <= maxQ; q += 0.2) {
                const mc = marginalCost(q, a, b, c);
                if (mc <= maxCost && mc >= 0) {
                    if (!started) { costCtx.moveTo(toX(q), toY(mc)); started = true; }
                    else costCtx.lineTo(toX(q), toY(mc));
                }
            }
            costCtx.stroke();
            
            // ATC curve
            costCtx.strokeStyle = '#805ad5';
            costCtx.lineWidth = 3;
            costCtx.beginPath();
            started = false;
            for (let q = 1; q <= maxQ; q += 0.2) {
                const atc = ATC(q, FC, a, b, c);
                if (atc <= maxCost && atc > 0) {
                    if (!started) { costCtx.moveTo(toX(q), toY(atc)); started = true; }
                    else costCtx.lineTo(toX(q), toY(atc));
                }
            }
            costCtx.stroke();
            
            // AVC curve
            costCtx.strokeStyle = '#d69e2e';
            costCtx.lineWidth = 3;
            costCtx.beginPath();
            started = false;
            for (let q = 0.5; q <= maxQ; q += 0.2) {
                const avc = AVC(q, a, b, c);
                if (avc <= maxCost && avc >= 0) {
                    if (!started) { costCtx.moveTo(toX(q), toY(avc)); started = true; }
                    else costCtx.lineTo(toX(q), toY(avc));
                }
            }
            costCtx.stroke();
            
            // Optimal point (where P = MC)
            if (qStar > 0 && qStar <= maxQ) {
                const mcAtQ = marginalCost(qStar, a, b, c);
                
                if (mcAtQ <= maxCost) {
                    // Dashed line to Q axis
                    costCtx.strokeStyle = '#a0aec0';
                    costCtx.lineWidth = 1;
                    costCtx.setLineDash([5, 3]);
                    costCtx.beginPath();
                    costCtx.moveTo(toX(qStar), toY(mcAtQ));
                    costCtx.lineTo(toX(qStar), toY(0));
                    costCtx.stroke();
                    costCtx.setLineDash([]);
                    
                    // Point glow
                    const gradient = costCtx.createRadialGradient(toX(qStar), toY(mcAtQ), 0, toX(qStar), toY(mcAtQ), 18);
                    gradient.addColorStop(0, 'rgba(49, 151, 149, 0.5)');
                    gradient.addColorStop(1, 'rgba(49, 151, 149, 0)');
                    costCtx.fillStyle = gradient;
                    costCtx.beginPath();
                    costCtx.arc(toX(qStar), toY(mcAtQ), 18, 0, Math.PI * 2);
                    costCtx.fill();
                    
                    // Point
                    costCtx.fillStyle = '#319795';
                    costCtx.beginPath();
                    costCtx.arc(toX(qStar), toY(mcAtQ), 8, 0, Math.PI * 2);
                    costCtx.fill();
                    costCtx.strokeStyle = '#ffffff';
                    costCtx.lineWidth = 2;
                    costCtx.stroke();
                    
                    // Label
                    costCtx.fillStyle = '#1a202c';
                    costCtx.font = 'bold 11px Segoe UI';
                    costCtx.textAlign = 'left';
                    costCtx.fillText(`Q*=${qStar.toFixed(1)}`, toX(qStar) + 10, toY(mcAtQ) + 4);
                }
            }
            
            // Curve labels
            costCtx.font = 'bold 11px Segoe UI';
            costCtx.textAlign = 'left';
            
            // Find good label positions
            const mcLabelQ = Math.min(maxQ * 0.75, qStar > 0 ? qStar * 1.3 : 15);
            const mcLabelY = marginalCost(mcLabelQ, a, b, c);
            if (mcLabelY <= maxCost) {
                costCtx.fillStyle = '#e53e3e';
                costCtx.fillText('MC', toX(mcLabelQ), toY(mcLabelY) - 8);
            }
            
            const atcLabelQ = 18;
            const atcLabel = ATC(atcLabelQ, FC, a, b, c);
            if (atcLabel <= maxCost) {
                costCtx.fillStyle = '#805ad5';
                costCtx.fillText('ATC', toX(atcLabelQ), toY(atcLabel) - 8);
            }
            
            const avcLabelQ = 20;
            const avcLabel = AVC(avcLabelQ, a, b, c);
            if (avcLabel <= maxCost) {
                costCtx.fillStyle = '#d69e2e';
                costCtx.fillText('AVC', toX(avcLabelQ), toY(avcLabel) + 15);
            }
        }
        
        function updateDisplay() {
            const P = parseFloat(priceSlider.value);
            const FC = parseFloat(fcSlider.value);
            const a = parseFloat(aSlider.value);
            const b = parseFloat(bSlider.value);
            const c = parseFloat(cSlider.value);
            
            // Update slider display values
            document.getElementById('price-value').textContent = `$${P.toFixed(2)}`;
            document.getElementById('fc-value').textContent = `$${FC}`;
            document.getElementById('a-value').textContent = `$${a.toFixed(2)}`;
            document.getElementById('b-value').textContent = b.toFixed(2);
            document.getElementById('c-value').textContent = c.toFixed(3);
            
            // Calculate optimal values
            const qStar = optimalQ(P, a, b, c);
            const TR = P * qStar;
            const TC = totalCost(qStar, FC, a, b, c);
            const profit = TR - TC;
            const atcAtQ = qStar > 0 ? ATC(qStar, FC, a, b, c) : 0;
            const avcAtQ = qStar > 0 ? AVC(qStar, a, b, c) : 0;
            const mcAtQ = marginalCost(qStar, a, b, c);
            
            // Get shutdown point
            const minAVC = minAVCPoint(a, b, c);
            
            // Update info box
            document.getElementById('opt-q').textContent = qStar.toFixed(1);
            document.getElementById('total-revenue').textContent = `$${TR.toFixed(2)}`;
            document.getElementById('total-cost').textContent = `$${TC.toFixed(2)}`;
            document.getElementById('atc-at-q').textContent = `$${atcAtQ.toFixed(2)}`;
            document.getElementById('avc-at-q').textContent = `$${avcAtQ.toFixed(2)}`;
            document.getElementById('mc-at-q').textContent = `$${mcAtQ.toFixed(2)}`;
            
            // Update profit display
            const profitDisplay = document.getElementById('profit-display');
            const profitValue = document.getElementById('profit-value');
            
            if (Math.abs(profit) < 0.5) {
                profitDisplay.className = 'profit-display zero';
                profitValue.className = 'profit-value zero';
                profitValue.textContent = '$0.00';
            } else if (profit > 0) {
                profitDisplay.className = 'profit-display positive';
                profitValue.className = 'profit-value positive';
                profitValue.textContent = `+$${profit.toFixed(2)}`;
            } else {
                profitDisplay.className = 'profit-display negative';
                profitValue.className = 'profit-value negative';
                profitValue.textContent = `-$${Math.abs(profit).toFixed(2)}`;
            }
            
            // Update decision box
            const decisionBox = document.getElementById('decision-box');
            if (P >= minAVC.avc) {
                if (P >= atcAtQ) {
                    decisionBox.innerHTML = `<strong>Decision:</strong> <span class="produce">PRODUCE</span> ‚Äî Price exceeds ATC. Firm earns economic profit!`;
                } else {
                    decisionBox.innerHTML = `<strong>Decision:</strong> <span class="produce">PRODUCE</span> ‚Äî Price exceeds AVC ($${minAVC.avc.toFixed(2)}) but below ATC. Firm minimizes losses by producing.`;
                }
            } else {
                decisionBox.innerHTML = `<strong>Decision:</strong> <span class="shutdown">SHUTDOWN</span> ‚Äî Price below min AVC ($${minAVC.avc.toFixed(2)}). Firm loses less by not producing.`;
            }
            
            // Redraw graphs
            drawTotalGraph();
            drawCostGraph();
        }
        
        // Event listeners
        [priceSlider, fcSlider, aSlider, bSlider, cSlider].forEach(slider => {
            slider.addEventListener('input', updateDisplay);
        });
        
        // Initial draw
        updateDisplay();
    </script>
</body>
</html>
